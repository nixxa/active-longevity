define([require],function(){"use strict";var e={KEY_STR:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(e){for(var t,r,i,a,n,c="",s="",h="",f=0;i=(t=e[f++])>>2,a=(3&t)<<4|(r=e[f++])>>4,n=(15&r)<<2|(s=e[f++])>>6,h=63&s,isNaN(r)?n=h=64:isNaN(s)&&(h=64),c=c+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(n)+this.KEY_STR.charAt(h),t=r=s="",i=a=n=h="",f<e.length;);return c},restore:function(e,t){if(!e.match("data:image/jpeg;base64,"))return t;var r=this.decode64(e.replace("data:image/jpeg;base64,","")),i=this.slice2Segments(r),a=this.exifManipulation(t,i);return this.encode64(a)},exifManipulation:function(e,t){var r=this.getExifArray(t),i=this.insertExif(e,r);return new Uint8Array(i)},getExifArray:function(e){for(var t,r=0;r<e.length;r++)if(255==(t=e[r])[0]&225==t[1])return t;return[]},insertExif:function(e,t){var r=e.replace("data:image/jpeg;base64,",""),i=this.decode64(r),a=i.indexOf(255,3),n=i.slice(0,a),c=i.slice(a),s=n;return s=(s=s.concat(t)).concat(c)},slice2Segments:function(e){for(var t=0,r=[];!(255==e[t]&218==e[t+1]);){if(255==e[t]&216==e[t+1])t+=2;else{var i=t+(256*e[t+2]+e[t+3])+2,a=e.slice(t,i);r.push(a),t=i}if(t>e.length)break}return r},decode64:function(e){var t,r,i,a,n="",c="",s=0,h=[];for(/[^A-Za-z0-9\+\/\=]/g.exec(e)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");t=this.KEY_STR.indexOf(e.charAt(s++))<<2|(i=this.KEY_STR.indexOf(e.charAt(s++)))>>4,r=(15&i)<<4|(a=this.KEY_STR.indexOf(e.charAt(s++)))>>2,n=(3&a)<<6|(c=this.KEY_STR.indexOf(e.charAt(s++))),h.push(t),64!=a&&h.push(r),64!=c&&h.push(n),t=r=n="",i=a=c="",s<e.length;);return h}};return e});