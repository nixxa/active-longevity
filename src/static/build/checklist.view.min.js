define(["require","jquery","bootstrap","exifRestorer"],function(e,t,r,n){"use strict";function a(e){var r=t("#form"),n=new FormData(r[0]),a=n.get("photo"),o=new File([function(e){for(var t=atob(e.split(",")[1]),r=[],n=0;n<t.length;n++)r.push(t.charCodeAt(n));return new Blob([new Uint8Array(r)],{type:"image/jpeg"})}(e)],a.name,{type:a.type});n.set("photo",o),t.ajax({type:"POST",url:r.attr("action"),data:n,contentType:!1,processData:!1,success:function(e){e&&(window.location.href=e.url)},error:function(e){alert("There was an error uploading your file!")}})}function o(e){var t=new FileReader;t.onloadend=function(r){var n,o,i;n=t.result,o=e.type,(i=new Image).src=n,i.onload=function(){var e=i.width,t=i.height;if(e>800||t>800){var r,c;e>t?(c=t*(800/e),r=800):(r=e*(800/t),c=800);var u=document.createElement("canvas");u.width=r,u.height=c,u.getContext("2d").drawImage(this,0,0,r,c);var l=u.toDataURL(o);a(l="data:image/jpeg;base64,"+window.restorer.restore(n,l))}else a(n)},i.onerror=function(){alert("There was an error processing your file!")}},t.onerror=function(){alert("There was an error reading the file!")},t.readAsDataURL(e)}return window.restorer=n,{initialize:function(e){t(document).ready(function(){!function(e){var r=t("#photo"),n=t("#executor"),a=t("#activity");for(var i in n.on("change",function(r){if(""!=n.val()){a.html("");var o=e[n.val()];for(var i in o.length>1&&a.append(t("<option>",{value:"",text:"[ ... выберите из списка ... ]"})),o)a.append(t("<option>",{value:o[i],text:o[i]}))}}),e)n.append(t("<option>",{value:i,text:i}));t("#form-save").on("click",function(e){var t=r[0].files[0];t&&(/^image\//i.test(t.type)?o(t):alert("Not a valid image!"))})}(e)})}}});